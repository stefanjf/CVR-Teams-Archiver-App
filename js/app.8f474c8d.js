(function(e){function a(a){for(var r,o,i=a[0],c=a[1],l=a[2],d=0,p=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&p.push(n[o][0]),n[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);u&&u(a);while(p.length)p.shift()();return s.push.apply(s,l||[]),t()}function t(){for(var e,a=0;a<s.length;a++){for(var t=s[a],r=!0,i=1;i<t.length;i++){var c=t[i];0!==n[c]&&(r=!1)}r&&(s.splice(a--,1),e=o(o.s=t[0]))}return e}var r={},n={app:0},s=[];function o(a){if(r[a])return r[a].exports;var t=r[a]={i:a,l:!1,exports:{}};return e[a].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=e,o.c=r,o.d=function(e,a,t){o.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:t})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,a){if(1&a&&(e=o(e)),8&a)return e;if(4&a&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var r in e)o.d(t,r,function(a){return e[a]}.bind(null,r));return t},o.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(a,"a",a),a},o.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},o.p="/CVR-Teams-Archiver-App/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=a,i=i.slice();for(var l=0;l<i.length;l++)a(i[l]);var u=c;s.push([0,"chunk-vendors"]),t()})({0:function(e,a,t){e.exports=t("56d7")},"56d7":function(e,a,t){"use strict";t.r(a);t("e260"),t("e6cf"),t("cca6"),t("a79d");var r=t("2b0e"),n=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("v-app",[t("v-app-bar",{attrs:{app:"",color:"blue-grey",dark:""}},[t("h3",{staticClass:"headline"},[e._v("CVR Teams Channel Archiver")]),t("v-spacer"),t("v-btn",{staticClass:"mr-2",attrs:{text:"",color:"white",href:"https://airmencoders.us/",target:"_blank"}},[e._v(" #BuiltByAirmen ")]),t("v-btn",{attrs:{color:"grey darken-2",href:"https://github.com/stefanjf/CVR-Teams-Archiver-App",target:"_blank"}},[e._v(" Source Code "),t("v-icon",[e._v(" mdi-open-in-new ")])],1)],1),t("v-main",[t("MessageArchiver")],1)],1)},s=[],o=function(){var e=this,a=e.$createElement,r=e._self._c||a;return r("v-container",[r("v-row",{staticClass:"text-center"},[r("v-col",{},[r("v-alert",{attrs:{border:"bottom",color:"grey darken-1",type:"info",dark:"",dense:""}},[r("div",{staticClass:"mb-1 text--grey",staticStyle:{"text-align":"left"}},[e._v("Need assistance or to report a problem? Contact stefan.j.fernandez.mil@cvr.mil on CVR Teams.")])]),r("v-expansion-panels",{staticClass:"pb-2"},[r("v-expansion-panel",{staticClass:"grey lighten-2"},[r("v-expansion-panel-header",[r("span",[r("v-icon",{attrs:{color:"grey darken-2",left:""}},[e._v(" mdi-help ")]),e._v(" Frequently Asked Questions")],1)]),r("v-expansion-panel-content",{staticStyle:{"text-align":"left"}},[r("ul",[r("li",{staticClass:"mb-2"},[r("strong",[e._v("Can I archive regular Chat groups? ")]),r("br"),r("span",[e._v("Unfortunately I have not found a way to access regular Chat groups. This workaround uses the Graph API token which does not have access to Chats. ")])]),r("li",{staticClass:"mb-2"},[r("strong",[e._v("Can I migrate these Channel messages to AFNET/CHES Teams?")]),r("br"),r("span",[e._v("No, that would require Teams admin access.")])]),r("li",{staticClass:"mb-2"},[r("strong",[e._v("What format should I choose?")]),r("br"),r("span",[e._v("Probably HTML. If you want a Word document, use HTML and then copy/paste into Word. The JSON version is for anyone who wants all the data to parse themselves.")])])])])],1),r("v-expansion-panel",{staticClass:"grey lighten-2"},[r("v-expansion-panel-header",[r("span",[r("v-icon",{attrs:{color:"grey darken-2",left:""}},[e._v(" mdi-information-outline ")]),e._v(" How to get an Access Token?")],1)]),r("v-expansion-panel-content",{staticStyle:{"text-align":"left"}},[r("ul",[r("li",[r("span",[e._v("1. Navigate to "),r("a",{attrs:{href:"https://developer.microsoft.com/en-us/graph/graph-explorer"}},[e._v("https://developer.microsoft.com/en-us/graph/graph-explorer")])])]),r("li",[r("span",[e._v("2. Sign in with your CVR Teams account ")])]),r("li",[r("span",[e._v("3. Click the 'Access Token' tab and copy the token. ")])])]),r("br"),r("img",{attrs:{src:t("c080"),alt:"ex",title:"token",width:"600"}})])],1)],1),r("v-text-field",{attrs:{label:"Enter your access token"},model:{value:e.accessToken,callback:function(a){e.accessToken=a},expression:"accessToken"}}),r("v-btn",{attrs:{color:"green lighten-2"},on:{click:function(a){return a.stopPropagation(),e.getListOfTeams(a)}}},[e._v("List Channels")])],1),r("v-col",{staticClass:"mb-5",attrs:{cols:"12"}},[r("v-simple-table",{attrs:{dense:"",height:"500px"},scopedSlots:e._u([{key:"default",fn:function(){return[r("thead",[r("tr",[r("th",{staticClass:"text-left"},[e._v("Team")]),r("th",{staticClass:"text-left"},[e._v("Name")]),r("th",{staticClass:"text-left"},[e._v("Download")])])]),r("tbody",e._l(e.myListOfChannels,(function(a){return r("tr",{key:a.id},[r("td",{staticStyle:{"text-align":"left"}},[e._v(e._s(a.teamName))]),r("td",{staticStyle:{"text-align":"left"}},[e._v(e._s(a.displayName))]),r("td",[r("v-btn",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return t.stopPropagation(),e.saveToHTMLFile(a)}}},[e._v("HTML")]),r("v-btn",{attrs:{small:""},on:{click:function(t){return t.stopPropagation(),e.saveToJSONFile(a)}}},[e._v("JSON")])],1)])})),0)]},proxy:!0}])}),r("v-dialog",{attrs:{"hide-overlay":"",persistent:"",width:"300"},model:{value:e.isLoading,callback:function(a){e.isLoading=a},expression:"isLoading"}},[r("v-card",{attrs:{color:"primary",dark:""}},[r("v-card-text",[e._v(" "+e._s(e.loadingText)+" "),r("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)],1)],1),r("v-snackbar",{attrs:{timeout:"3000"},scopedSlots:e._u([{key:"action",fn:function(a){var t=a.attrs;return[r("v-btn",e._b({attrs:{color:"red",text:""},on:{click:function(a){e.showErrorSnackbar=!1}}},"v-btn",t,!1),[e._v(" Close ")])]}}]),model:{value:e.showErrorSnackbar,callback:function(a){e.showErrorSnackbar=a},expression:"showErrorSnackbar"}},[e._v(" "+e._s(e.errors)+" ")])],1)],1)],1)},i=[],c=t("53ca"),l=t("1da1"),u=t("b85c"),d=(t("99af"),t("ac1f"),t("5319"),t("96cf"),t("bc3a")),p=t.n(d),h=t("21a6"),f={name:"MessageArchiver",data:function(){return{accessToken:"",myListOfChannels:[],allMessagesRaw:[],errors:"",showErrorSnackbar:!1,isLoading:!1,loadingText:""}},computed:{headers:function(){return{Authorization:this.accessToken}}},methods:{getListOfTeams:function(){var e=this;this.isLoading=!0,this.loadingText="Getting your Teams and Channels",this.myListOfChannels=[];var a="https://graph.microsoft.com/beta/me/joinedTeams";p.a.get(a,{headers:this.headers}).then((function(a){var t,r=Object(u["a"])(a.data["value"]);try{var n=function(){var a=t.value;p.a.get("https://graph.microsoft.com/beta/teams/"+a["id"]+"/channels",{headers:e.headers}).then((function(t){var r,n=Object(u["a"])(t.data["value"]);try{for(n.s();!(r=n.n()).done;){var s=r.value;s["teamName"]=a["displayName"],s["teamID"]=a["id"],e.myListOfChannels.push(s)}}catch(err){n.e(err)}finally{n.f()}e.isLoading=!1})).catch((function(a){e.errors=a,e.showErrorSnackbar=!0,e.isLoading=!1}))};for(r.s();!(t=r.n()).done;)n()}catch(err){r.e(err)}finally{r.f()}})).catch((function(a){e.errors=a,e.showErrorSnackbar=!0,e.isLoading=!1}))},downloadRawMessages:function(e){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var r,n,s,o,i,c,l,d,h,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r="",n="https://graph.microsoft.com/beta/teamszz/"+e["teamID"]+"/channels/"+e["id"]+"/messages?$top=100",t.prev=2,t.next=5,p.a.get(n,{headers:a.headers});case 5:s=t.sent,o=Object(u["a"])(s.data["value"]);try{for(o.s();!(i=o.n()).done;)c=i.value,a.allMessagesRaw.push(c)}catch(err){o.e(err)}finally{o.f()}if(!a.isThereMoreMessages(s)){t.next=32;break}r=s.data["@odata.nextLink"],console.log("more messages found",s);case 11:return t.prev=12,t.next=15,p.a.get(r,{headers:a.headers});case 15:l=t.sent,t.next=23;break;case 18:t.prev=18,t.t0=t["catch"](12),a.errors=err,a.showErrorSnackbar=!0,a.isLoading=!1;case 23:d=Object(u["a"])(l.data["value"]);try{for(d.s();!(h=d.n()).done;)f=h.value,a.allMessagesRaw.push(f)}catch(err){d.e(err)}finally{d.f()}if(!a.isThereMoreMessages(l)){t.next=29;break}r=l.data["@odata.nextLink"],t.next=30;break;case 29:return t.abrupt("break",32);case 30:t.next=11;break;case 32:return t.next=34,a.addRepliesToRawMessages(e["teamID"],e["id"]);case 34:t.next=41;break;case 36:t.prev=36,t.t1=t["catch"](2),a.errors=t.t1,a.showErrorSnackbar=!0,a.isLoading=!1;case 41:case"end":return t.stop()}}),t,null,[[2,36],[12,18]])})))()},addRepliesToRawMessages:function(e,a){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function r(){var n,s,o,i,c,l,d,h,f,v,g,m,b;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:console.log("start adding in replies"),n="",s=Object(u["a"])(t.allMessagesRaw),r.prev=3,s.s();case 5:if((o=s.n()).done){r.next=48;break}return i=o.value,c="https://graph.microsoft.com/beta/teams/"+e+"/channels/"+a+"/messages/"+i["id"]+"/replies",r.prev=8,r.next=11,p.a.get(c,{headers:t.headers});case 11:l=r.sent,i["replies"]=[],d=Object(u["a"])(l.data["value"]);try{for(d.s();!(h=d.n()).done;)f=h.value,i["replies"].push(f)}catch(err){d.e(err)}finally{d.f()}if(!t.isThereMoreMessages(l)){r.next=39;break}n=l.data["@odata.nextLink"],v=void 0;case 18:return r.prev=19,r.next=22,p.a.get(n,{headers:t.headers});case 22:v=r.sent,g=Object(u["a"])(v.data["value"]);try{for(g.s();!(m=g.n()).done;)b=m.value,i["replies"].push(b)}catch(err){g.e(err)}finally{g.f()}if(!t.isThereMoreMessages(v)){r.next=29;break}n=v.data["@odata.nextLink"],r.next=30;break;case 29:return r.abrupt("break",39);case 30:r.next=37;break;case 32:r.prev=32,r.t0=r["catch"](19),t.errors=err,t.showErrorSnackbar=!0,t.isLoading=!1;case 37:r.next=18;break;case 39:r.next=46;break;case 41:r.prev=41,r.t1=r["catch"](8),t.errors=err,t.showErrorSnackbar=!0,t.isLoading=!1;case 46:r.next=5;break;case 48:r.next=53;break;case 50:r.prev=50,r.t2=r["catch"](3),s.e(r.t2);case 53:return r.prev=53,s.f(),r.finish(53);case 56:case"end":return r.stop()}}),r,null,[[3,50,53,56],[8,41],[19,32]])})))()},isThereMoreMessages:function(e){var a=Object(c["a"])(e.data["@odata.nextLink"]);return"undefined"!=a},saveToJSONFile:function(e){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a.isLoading=!0,a.loadingText="Downloading all messages. This may take a while...",t.next=4,a.downloadRawMessages(e);case 4:a.isLoading=!1,r=new Blob([JSON.stringify(a.allMessagesRaw)],{type:"text/plain;charset=utf-8"}),n=new Date,h.saveAs(r,"".concat(e.teamName,"_").concat(e.displayName,"_archive_").concat(n.toISOString(),".txt"));case 8:case"end":return t.stop()}}),t)})))()},saveToHTMLFile:function(e){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a.isLoading=!0,a.loadingText="Downloading all messages. This may take a while...",a.downloadRawMessages(e).then((function(){var t="";a.allMessagesRaw.sort((function(e,a){var t=new Date(e.createdDateTime),r=new Date(a.createdDateTime);return t-r}));var r,n=Object(u["a"])(a.allMessagesRaw);try{for(n.s();!(r=n.n()).done;){var s=r.value,o=a.lodash.get(s,"body.content","unknown"),i=a.lodash.get(s,"from.user.displayName","unknown"),c=a.lodash.get(s,"createdDateTime","unknown");o&&(o=o.replace(/\n+/g,""),o=o.replace(/\t+/g,"")),t+="<hr><hr><h3>"+i+":</h3><h5>Created: "+c+"</h5>"+o+"<blockquote>",s["replies"].sort((function(e,a){var t=new Date(e.createdDateTime),r=new Date(a.createdDateTime);return t-r}));var l,d=Object(u["a"])(s["replies"]);try{for(d.s();!(l=d.n()).done;){var p=l.value,f=a.lodash.get(p,"from.user.displayName","unknown"),v=a.lodash.get(p,"body.content","unknown"),g=a.lodash.get(p,"createdDateTime","unknown");v&&(v=v.replace(/\n+/g,""),v=v.replace(/\t+/g,"")),t+="<h3>Reply From: "+f+"</h3><h5>Created: "+g+"</h5>"+v}}catch(err){d.e(err)}finally{d.f()}t+="</blockquote>"}}catch(err){n.e(err)}finally{n.f()}a.isLoading=!1;var m=new Blob([JSON.stringify(t)],{type:"text/plain;charset=utf-8"}),b=new Date;h.saveAs(m,"".concat(e.teamName,"_").concat(e.displayName,"_archive_").concat(b.toISOString(),".html"))}));case 3:case"end":return t.stop()}}),t)})))()}}},v=f,g=t("2877"),m=t("6544"),b=t.n(m),k=t("0798"),y=t("8336"),w=t("b0af"),x=t("99d9"),T=t("62ad"),_=t("a523"),C=t("169a"),O=t("cd55"),S=t("49e2"),M=t("c865"),L=t("0393"),R=t("132d"),j=t("8e36"),V=t("0fd9"),A=t("1f4f"),N=t("2db4"),E=t("8654"),D=Object(g["a"])(v,o,i,!1,null,null,null),P=D.exports;b()(D,{VAlert:k["a"],VBtn:y["a"],VCard:w["a"],VCardText:x["a"],VCol:T["a"],VContainer:_["a"],VDialog:C["a"],VExpansionPanel:O["a"],VExpansionPanelContent:S["a"],VExpansionPanelHeader:M["a"],VExpansionPanels:L["a"],VIcon:R["a"],VProgressLinear:j["a"],VRow:V["a"],VSimpleTable:A["a"],VSnackbar:N["a"],VTextField:E["a"]});var I={name:"App",components:{MessageArchiver:P},data:function(){return{}}},F=I,H=t("7496"),J=t("40dc"),B=t("f6c4"),q=t("2fa4"),z=Object(g["a"])(F,n,s,!1,null,null,null),$=z.exports;b()(z,{VApp:H["a"],VAppBar:J["a"],VBtn:y["a"],VIcon:R["a"],VMain:B["a"],VSpacer:q["a"]});var W=t("f309");r["a"].use(W["a"]);var G=new W["a"]({}),Q=t("9955"),U=t.n(Q),K=t("2ef0"),X=t.n(K);r["a"].config.productionTip=!1,r["a"].use(U.a,{name:"custom",lodash:X.a}),new r["a"]({vuetify:G,render:function(e){return e($)}}).$mount("#app")},c080:function(e,a,t){e.exports=t.p+"img/token.80b04f6e.png"}});
//# sourceMappingURL=app.8f474c8d.js.map