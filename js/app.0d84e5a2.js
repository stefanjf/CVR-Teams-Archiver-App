(function(e){function a(a){for(var n,i,o=a[0],c=a[1],l=a[2],d=0,p=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&p.push(r[i][0]),r[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(a);while(p.length)p.shift()();return s.push.apply(s,l||[]),t()}function t(){for(var e,a=0;a<s.length;a++){for(var t=s[a],n=!0,o=1;o<t.length;o++){var c=t[o];0!==r[c]&&(n=!1)}n&&(s.splice(a--,1),e=i(i.s=t[0]))}return e}var n={},r={app:0},s=[];function i(a){if(n[a])return n[a].exports;var t=n[a]={i:a,l:!1,exports:{}};return e[a].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=e,i.c=n,i.d=function(e,a,t){i.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:t})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,a){if(1&a&&(e=i(e)),8&a)return e;if(4&a&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var n in e)i.d(t,n,function(a){return e[a]}.bind(null,n));return t},i.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(a,"a",a),a},i.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},i.p="/CVR-Teams-Archiver-App/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=a,o=o.slice();for(var l=0;l<o.length;l++)a(o[l]);var u=c;s.push([0,"chunk-vendors"]),t()})({0:function(e,a,t){e.exports=t("56d7")},"56d7":function(e,a,t){"use strict";t.r(a);t("e260"),t("e6cf"),t("cca6"),t("a79d");var n=t("2b0e"),r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("v-app",[t("v-app-bar",{attrs:{app:"",color:"blue-grey",dark:""}},[t("h3",{staticClass:"headline"},[e._v("CVR Teams Channel Archiver")]),t("v-spacer"),t("v-btn",{staticClass:"mr-2",attrs:{text:"",color:"white",href:"https://airmencoders.us/",target:"_blank"}},[e._v(" #BuiltByAirmen ")]),t("v-btn",{attrs:{color:"grey darken-2",href:"https://github.com/stefanjf/CVR-Teams-Archiver-App",target:"_blank"}},[e._v(" Source Code "),t("v-icon",[e._v(" mdi-open-in-new ")])],1)],1),t("v-main",[t("MessageArchiver")],1)],1)},s=[],i=function(){var e=this,a=e.$createElement,n=e._self._c||a;return n("v-container",[n("v-row",{staticClass:"text-center"},[n("v-col",{},[n("v-alert",{attrs:{border:"bottom",color:"grey darken-1",type:"info",dark:"",dense:""}},[n("div",{staticClass:"mb-1 text--grey",staticStyle:{"text-align":"left"}},[e._v("Need assistance or to report a problem? Contact stefan.j.fernandez.mil@cvr.mil on CVR Teams or stefan.fernandez.1@us.af.mil.")])]),n("v-expansion-panels",{staticClass:"pb-2"},[n("v-expansion-panel",{staticClass:"grey lighten-2"},[n("v-expansion-panel-header",[n("span",[n("v-icon",{attrs:{color:"grey darken-2",left:""}},[e._v(" mdi-help ")]),e._v(" Frequently Asked Questions")],1)]),n("v-expansion-panel-content",{staticStyle:{"text-align":"left"}},[n("ul",[n("li",{staticClass:"mb-2"},[n("strong",[e._v("Can I archive regular Chat groups? ")]),n("br"),n("span",[e._v("Unfortunately I have not found a way to access regular Chat groups. This workaround uses the Graph API token which does not have access to Chats. ")])]),n("li",{staticClass:"mb-2"},[n("strong",[e._v("Can I migrate these Channel messages to AFNET/CHES Teams?")]),n("br"),n("span",[e._v("No, that would require Teams admin access.")])]),n("li",{staticClass:"mb-2"},[n("strong",[e._v("What format should I choose?")]),n("br"),n("span",[e._v("Probably HTML. If you want a Word document, use HTML and then copy/paste into Word. The JSON version is for anyone who wants all the data to parse themselves.")])])])])],1),n("v-expansion-panel",{staticClass:"grey lighten-2"},[n("v-expansion-panel-header",[n("span",[n("v-icon",{attrs:{color:"grey darken-2",left:""}},[e._v(" mdi-information-outline ")]),e._v(" How to get an Access Token?")],1)]),n("v-expansion-panel-content",{staticStyle:{"text-align":"left"}},[n("ul",[n("li",[n("span",[e._v("1. Navigate to "),n("a",{attrs:{href:"https://developer.microsoft.com/en-us/graph/graph-explorer"}},[e._v("https://developer.microsoft.com/en-us/graph/graph-explorer")])])]),n("li",[n("span",[e._v("2. Sign in with your CVR Teams account ")])]),n("li",[n("span",[e._v("3. Click the 'Access Token' tab and copy the token. ")])])]),n("br"),n("img",{attrs:{src:t("c080"),alt:"ex",title:"token",width:"600"}})])],1)],1),n("v-text-field",{attrs:{label:"Enter your access token"},model:{value:e.accessToken,callback:function(a){e.accessToken=a},expression:"accessToken"}}),n("v-btn",{attrs:{color:"green lighten-2"},on:{click:function(a){return a.stopPropagation(),e.getListOfTeams(a)}}},[e._v("List Channels")])],1),n("v-col",{staticClass:"mb-5",attrs:{cols:"12"}},[n("v-simple-table",{attrs:{dense:"",height:"500px"},scopedSlots:e._u([{key:"default",fn:function(){return[n("thead",[n("tr",[n("th",{staticClass:"text-left"},[e._v("Team")]),n("th",{staticClass:"text-left"},[e._v("Name")]),n("th",{staticClass:"text-left"},[e._v("Download")])])]),n("tbody",e._l(e.myListOfChannels,(function(a){return n("tr",{key:a.id},[n("td",{staticStyle:{"text-align":"left"}},[e._v(e._s(a.teamName))]),n("td",{staticStyle:{"text-align":"left"}},[e._v(e._s(a.displayName))]),n("td",[n("v-btn",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return t.stopPropagation(),e.saveToHTMLFile(a)}}},[e._v("HTML")]),n("v-btn",{attrs:{small:""},on:{click:function(t){return t.stopPropagation(),e.saveToJSONFile(a)}}},[e._v("JSON")])],1)])})),0)]},proxy:!0}])}),n("v-dialog",{attrs:{width:"500"},model:{value:e.initialWarning,callback:function(a){e.initialWarning=a},expression:"initialWarning"}},[n("v-card",[n("v-card-title",{staticClass:"headline grey lighten-2"},[e._v(" Caution ")]),n("v-card-text",{staticClass:"mt-2"},[e._v(" This is not an official DoD website, and you should always think twice before entering your access token into a random website. "),n("br"),n("br"),e._v(" Feel free to verify the source code here: "),n("strong",[e._v("https://github.com/stefanjf/CVR-Teams-Archiver-App")]),n("br"),n("br"),e._v(" Or reach out to me at "),n("strong",[e._v("stefan.fernandez.1@us.af.mil")]),e._v(" and I can verify that this website is non-malicious and secure. ")]),n("v-divider"),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"primary",text:""},on:{click:function(a){return e.clickPopup()}}},[e._v(" I understand ")])],1)],1)],1),n("v-dialog",{attrs:{width:"500"},model:{value:e.initialWarning2,callback:function(a){e.initialWarning2=a},expression:"initialWarning2"}},[n("v-card",[n("v-card-title",{staticClass:"headline grey lighten-2"},[e._v(" FOUO/CUI ")]),n("v-card-text",{staticClass:"mt-2"},[e._v(" If your channel contains FOUO/CUI information then only use this app from an appropriate computer system. ")]),n("v-divider"),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"primary",text:""},on:{click:function(a){e.initialWarning2=!1}}},[e._v(" I understand ")])],1)],1)],1),n("v-dialog",{attrs:{"hide-overlay":"",persistent:"",width:"300"},model:{value:e.isLoading,callback:function(a){e.isLoading=a},expression:"isLoading"}},[n("v-card",{attrs:{color:"primary",dark:""}},[n("v-card-text",[e._v(" "+e._s(e.loadingText)+" "),n("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)],1)],1)],1)],1)],1)},o=[],c=t("53ca"),l=t("1da1"),u=t("b85c"),d=(t("99af"),t("ac1f"),t("5319"),t("96cf"),t("bc3a")),p=t.n(d),h=t("21a6"),f={name:"MessageArchiver",data:function(){return{accessToken:"",myListOfChannels:[],allMessagesRaw:[],errors:"",isLoading:!1,loadingText:"",initialWarning:!0,initialWarning2:!1}},computed:{headers:function(){return{Authorization:this.accessToken}}},methods:{clickPopup:function(){this.initialWarning=!1,this.initialWarning2=!0},getListOfTeams:function(){var e=this;this.isLoading=!0,this.loadingText="Getting your Teams and Channels",this.myListOfChannels=[];var a="https://graph.microsoft.com/beta/me/joinedTeams";p.a.get(a,{headers:this.headers}).then((function(a){var t,n=Object(u["a"])(a.data["value"]);try{var r=function(){var a=t.value;p.a.get("https://graph.microsoft.com/beta/teams/"+a["id"]+"/channels",{headers:e.headers}).then((function(t){var n,r=Object(u["a"])(t.data["value"]);try{for(r.s();!(n=r.n()).done;){var s=n.value;s["teamName"]=a["displayName"],s["teamID"]=a["id"],e.myListOfChannels.push(s)}}catch(i){r.e(i)}finally{r.f()}e.isLoading=!1})).catch((function(a){e.errors=a,e.isLoading=!1}))};for(n.s();!(t=n.n()).done;)r()}catch(s){n.e(s)}finally{n.f()}})).catch((function(a){e.errors=a,e.isLoading=!1}))},downloadRawMessages:function(e){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n,r,s,i,o,c,l,d,h,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n="",r="https://graph.microsoft.com/beta/teams/"+e["teamID"]+"/channels/"+e["id"]+"/messages?$top=100",t.next=4,p.a.get(r,{headers:a.headers});case 4:s=t.sent,i=Object(u["a"])(s.data["value"]);try{for(i.s();!(o=i.n()).done;)c=o.value,a.allMessagesRaw.push(c)}catch(v){i.e(v)}finally{i.f()}if(!a.isThereMoreMessages(s)){t.next=29;break}n=s.data["@odata.nextLink"],console.log("more messages found",s);case 10:return t.prev=11,t.next=14,p.a.get(n,{headers:a.headers});case 14:l=t.sent,t.next=20;break;case 17:t.prev=17,t.t0=t["catch"](11),console.log(t.t0);case 20:d=Object(u["a"])(l.data["value"]);try{for(d.s();!(h=d.n()).done;)f=h.value,a.allMessagesRaw.push(f)}catch(v){d.e(v)}finally{d.f()}if(!a.isThereMoreMessages(l)){t.next=26;break}n=l.data["@odata.nextLink"],t.next=27;break;case 26:return t.abrupt("break",29);case 27:t.next=10;break;case 29:return t.next=31,a.addRepliesToRawMessages(e["teamID"],e["id"]);case 31:case"end":return t.stop()}}),t,null,[[11,17]])})))()},addRepliesToRawMessages:function(e,a){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function n(){var r,s,i,o,c,l,d,h,f,v,g,m,b;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:console.log("start adding in replies"),r="",s=Object(u["a"])(t.allMessagesRaw),n.prev=3,s.s();case 5:if((i=s.n()).done){n.next=32;break}return o=i.value,c="https://graph.microsoft.com/beta/teams/"+e+"/channels/"+a+"/messages/"+o["id"]+"/replies",n.next=10,p.a.get(c,{headers:t.headers});case 10:l=n.sent,o["replies"]=[],d=Object(u["a"])(l.data["value"]);try{for(d.s();!(h=d.n()).done;)f=h.value,o["replies"].push(f)}catch(y){d.e(y)}finally{d.f()}if(!t.isThereMoreMessages(l)){n.next=30;break}r=l.data["@odata.nextLink"],v=void 0;case 17:return n.next=20,p.a.get(r,{headers:t.headers});case 20:v=n.sent,g=Object(u["a"])(v.data["value"]);try{for(g.s();!(m=g.n()).done;)b=m.value,o["replies"].push(b)}catch(y){g.e(y)}finally{g.f()}if(!t.isThereMoreMessages(v)){n.next=27;break}r=v.data["@odata.nextLink"],n.next=28;break;case 27:return n.abrupt("break",30);case 28:n.next=17;break;case 30:n.next=5;break;case 32:n.next=37;break;case 34:n.prev=34,n.t0=n["catch"](3),s.e(n.t0);case 37:return n.prev=37,s.f(),n.finish(37);case 40:case"end":return n.stop()}}),n,null,[[3,34,37,40]])})))()},isThereMoreMessages:function(e){var a=Object(c["a"])(e.data["@odata.nextLink"]);return"undefined"!=a},saveToJSONFile:function(e){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a.isLoading=!0,a.loadingText="Downloading all messages. This may take a while...",t.next=4,a.downloadRawMessages(e);case 4:a.isLoading=!1,n=new Blob([JSON.stringify(a.allMessagesRaw)],{type:"text/plain;charset=utf-8"}),r=new Date,h.saveAs(n,"".concat(e.teamName,"_").concat(e.displayName,"_archive_").concat(r.toISOString(),".txt"));case 8:case"end":return t.stop()}}),t)})))()},saveToHTMLFile:function(e){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n,r,s,i,o,c,l,d,p,f,v,g,m,b,y,x;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a.isLoading=!0,a.loadingText="Downloading all messages. This may take a while...",t.next=4,a.downloadRawMessages(e);case 4:n="",a.allMessagesRaw.sort((function(e,a){var t=new Date(e.createdDateTime),n=new Date(a.createdDateTime);return t-n})),r=Object(u["a"])(a.allMessagesRaw);try{for(r.s();!(s=r.n()).done;){i=s.value,o=a.lodash.get(i,"body.content","unknown"),c=a.lodash.get(i,"from.user.displayName","unknown"),l=a.lodash.get(i,"createdDateTime","unknown"),d=a.lodash.get(i,"subject","")?a.lodash.get(i,"subject","")+"<br>":"",o&&(o=o.replace(/\n+/g,""),o=o.replace(/\t+/g,"")),n+="<hr><hr><h3 style='margin-bottom: 3'>"+c+":</h3><p style='margin-top: 0'>Sent: "+l+"</p><b>"+d+"</b>"+o+"<blockquote>",i["replies"].sort((function(e,a){var t=new Date(e.createdDateTime),n=new Date(a.createdDateTime);return t-n})),p=Object(u["a"])(i["replies"]);try{for(p.s();!(f=p.n()).done;)v=f.value,g=a.lodash.get(v,"from.user.displayName","unknown"),m=a.lodash.get(v,"body.content","unknown"),b=a.lodash.get(v,"createdDateTime","unknown"),m&&(m=m.replace(/\n+/g,""),m=m.replace(/\t+/g,"")),n+="<h3 style='margin-bottom: 3'>Reply From: "+g+"</h3><p style='margin-top: 0'>Sent: "+b+"</p>"+m}catch(w){p.e(w)}finally{p.f()}n+="</blockquote>"}}catch(w){r.e(w)}finally{r.f()}a.isLoading=!1,y=new Blob([n],{type:"text/plain;charset=utf-8"}),x=new Date,h.saveAs(y,"".concat(e.teamName,"_").concat(e.displayName,"_archive_").concat(x.toISOString(),".html"));case 12:case"end":return t.stop()}}),t)})))()}}},v=f,g=t("2877"),m=t("6544"),b=t.n(m),y=t("0798"),x=t("8336"),w=t("b0af"),k=t("99d9"),_=t("62ad"),T=t("a523"),C=t("169a"),O=t("ce7e"),M=t("cd55"),V=t("49e2"),j=t("c865"),L=t("0393"),R=t("132d"),S=t("8e36"),A=t("0fd9"),D=t("1f4f"),N=t("2fa4"),I=t("8654"),P=Object(g["a"])(v,i,o,!1,null,null,null),W=P.exports;b()(P,{VAlert:y["a"],VBtn:x["a"],VCard:w["a"],VCardActions:k["a"],VCardText:k["b"],VCardTitle:k["c"],VCol:_["a"],VContainer:T["a"],VDialog:C["a"],VDivider:O["a"],VExpansionPanel:M["a"],VExpansionPanelContent:V["a"],VExpansionPanelHeader:j["a"],VExpansionPanels:L["a"],VIcon:R["a"],VProgressLinear:S["a"],VRow:A["a"],VSimpleTable:D["a"],VSpacer:N["a"],VTextField:I["a"]});var F={name:"App",components:{MessageArchiver:W},data:function(){return{}}},E=F,H=t("7496"),B=t("40dc"),J=t("f6c4"),U=Object(g["a"])(E,r,s,!1,null,null,null),q=U.exports;b()(U,{VApp:H["a"],VAppBar:B["a"],VBtn:x["a"],VIcon:R["a"],VMain:J["a"],VSpacer:N["a"]});var z=t("f309");n["a"].use(z["a"]);var $=new z["a"]({}),G=t("9955"),Q=t.n(G),K=t("2ef0"),X=t.n(K);n["a"].config.productionTip=!1,n["a"].use(Q.a,{name:"custom",lodash:X.a}),new n["a"]({vuetify:$,render:function(e){return e(q)}}).$mount("#app")},c080:function(e,a,t){e.exports=t.p+"img/token.80b04f6e.png"}});
//# sourceMappingURL=app.0d84e5a2.js.map